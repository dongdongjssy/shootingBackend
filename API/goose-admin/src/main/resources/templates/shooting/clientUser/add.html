<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<head th:include="include :: header"></head>
<link th:href="@{/ajax/libs/cropbox/cropbox.css}" rel="stylesheet"/>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-clientUser-add">
        <div class="form-group">
            <label class="col-sm-3 control-label">用户昵称：</label>
            <div class="col-sm-8">
                <input id="nickname" name="nickname" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">用户名：</label>
            <div class="col-sm-8">
                <input id="userName" name="userName" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">邮箱：</label>
            <div class="col-sm-8">
                <input id="email" name="email" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">手机号：</label>
            <div class="col-sm-8">
                <input id="phone" name="phone" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">真实姓名：</label>
            <div class="col-sm-8">
                <input id="realName" name="realName" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">射手编号：</label>
            <div class="col-sm-8">
                <input id="memberId" name="memberId" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">英文名：</label>
            <div class="col-sm-8">
                <input id="englishName" name="englishName" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">证件照片：</label>
            <div class="new-contentarea">
                <a href="javascript:void(0)" class="upload-img"> <label for="picture">上传图像</label> </a>
                <input type="file" class="" name="selfieImage" id="selfieImage" accept="image/*"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">图片预览：</label>
            <div class="col-sm-8">
                <div class="container">
                    <img id="imgpreviewselfie" class='imageBox'/>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">结业日期：</label>
            <div class="col-sm-8">
                <input id="graduateDate" name="graduateDate" class="form-control time-input" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">性别：</label>
            <div class="col-sm-8">
                <select id="sex" name="sex" class="form-control m-b"
                        th:with="type=${@dict.getType('client_user_gender')}">
                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">护照号码：</label>
            <div class="col-sm-8">
                <input id="passportNo" name="passportNo" class="form-control" type="text">
            </div>
        </div>
        <!-- 
        <div class="form-group">
            <label class="col-sm-3 control-label">用户微信：</label>
            <div class="col-sm-8">
                <input id="openId" name="openId" class="form-control" type="text">
            </div>
        </div>
         -->
        <div class="form-group">
            <label class="col-sm-3 control-label">用户头像：</label>
            <div class="col-sm-8">
                <div class="new-contentarea">
                    <a href="javascript:void(0)" class="upload-img"> <label for="picture">上传图像</label> </a>
                    <input type="file" class="" name="avatar" id="avatar" accept="image/*"/>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">图片预览：</label>
            <div class="col-sm-8">
                <div class="container">
                    <img id="imgpreviewavatar" class='imageBox'/>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">城市：</label>
            <div class="col-sm-8">
                <input id="city" name="city" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">地址：</label>
            <div class="col-sm-8">
                <input id="address" name="address" class="form-control" type="text">
            </div>
        </div>


        <div class="form-group">
            <label class="col-sm-3 control-label">认证状态：</label>
            <div class="col-sm-8">
                <select id="status" name="status" class="form-control m-b"
                        th:with="type=${@dict.getType('client_user_status')}">
                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}"></option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">认证有效期：</label>
            <div class="col-sm-8">
                <input id="certExpireDate" name="certExpireDate" class="form-control time-input" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">身份证号：</label>
            <div class="col-sm-8">
                <input id="idNumber" name="idNumber" class="form-control" type="text">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">角色：</label>
            <div class="col-sm-8">
                <select id="roleIds" name="roleIds" class="form-control" multiple>
                    <option th:each="fkRow:${ roleIdList}" th:value="${ fkRow.id}" th:text="${ fkRow.name}"></option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">所属俱乐部：</label>
            <div class="col-sm-8">
                <select id="myClubIds" name="myClubIds" class="form-control" multiple>
                    <option th:each="fkRow:${clubList}" th:value="${ fkRow.id}" th:text="${ fkRow.title}"></option>
                </select>
            </div>
        </div>
    </form>
</div>
<div th:include="include::footer"></div>
<script type="text/javascript">
    var prefix = ctx + "client/clientUser"

    $("#form-clientUser-add").validate({
        rules: {
            id: {
                required: false,
            },
            nickname: {
                required: true,
            },
            userName: {
                required: true,
                remote: {
                    url: ctx + "client/clientUser/checkUserNameUnique",
                    type: "post",
                    dataType: "json",
                    data: {
                        "userName": function () {
                            return $.common.trim($("#userName").val());
                        },
                    },
                    dataFilter: function (data, type) {
                        return $.validate.unique(data);
                    }
                },
            },
            email: {
                required: false,
            },
            phone: {
                required: true,
            },
            password: {
                required: false,
            },
            userType: {
                required: false,
            },
            openId: {
                required: false,
            },
            avatar: {
                required: false,
            },
            city: {
                required: false,
            },
            address: {
                required: false,
            },
            passwordResetDate: {
                required: false,
            },
            status: {
                required: false,
            },
            idNumber: {
                required: false,
            },
            realName: {
                required: false,
            },
            memberId: {
                required: true,
            },
            englishName: {
                required: false,
            },
            certExpireDate: {
                required: false,
            },
            selfieImage: {
                required: false,
            },
            graduateDate: {
                required: false,
            },
            sex: {
                required: false,
            },
            passportNo: {
                required: false,
            },
        },
        messages: {
            id: {},
            nickname: {},
            userName: {
                remote: "用户名已经存在"
            },
            email: {},
            phone: {},
            password: {},
            userType: {},
            openId: {},
            avatar: {},
            city: {},
            address: {},
            passwordResetDate: {},
            status: {},
            idNumber: {},
            realName: {},
            memberId: {},
            englishName: {},
            certExpireDate: {},
            selfieImage: {},
            graduateDate: {},
            sex: {},
            passportNo: {},
        }
    });

    function toggleRoleIdsSelection() {
        if ($("#status").val() == 2) {
            $("#roleIds").removeAttr('disabled');
        } else {
            $("#roleIds").prop('disabled', 'disabled');
        }
    }

    $("#status").on("change", function () {
        toggleRoleIdsSelection();
    })

    $(window).load(function () {
        toggleRoleIdsSelection();
    });

    function submitHandler() {
        if ($.validate.form()) {
            var formdata = new FormData();
            formdata.append("nickname", $("#nickname").val());
            formdata.append("userName", $("#userName").val());
            formdata.append("email", $("#email").val());
            formdata.append("phone", $("#phone").val());
            formdata.append("password", $("#password").val());
            formdata.append("userType", $("#userType").val());
            //      formdata.append("openId", $("#openId").val());
            formdata.append("city", $("#city").val());
            formdata.append("address", $("#address").val());
            formdata.append("passwordResetDate", $("#passwordResetDate").val());
            formdata.append("status", $("#status").val());
            formdata.append("idNumber", $("#idNumber").val());
            formdata.append("realName", $("#realName").val());
            formdata.append("memberId", $("#memberId").val());
            formdata.append("englishName", $("#englishName").val());
            formdata.append("certExpireDate", $("#certExpireDate").val());
            formdata.append("graduateDate", $("#graduateDate").val());
            formdata.append("sex", $("#sex").val());
            formdata.append("passportNo", $("#passportNo").val());
            formdata.append("roleIds", $("#roleIds").val());
            formdata.append("myClubIds", $("#myClubIds").val());


            var fileIdx = 0;
            fileIdx = $('input[type=file]').length - 2;
            formdata.append("selfieImageFile", $('input[type=file]')[fileIdx].files[0]);
            fileIdx = $('input[type=file]').length - 1;
            formdata.append("avatarFile", $('input[type=file]')[fileIdx].files[0]);

            $.ajax({
                url: prefix + "/add",
                data: formdata,
                type: "post",
                processData: false,
                contentType: false,
                success: function (result) {
                    $.operate.saveSuccess(result);
                }
            })

        }
    }

    $(window).load(function () {
        $("#roleIds").prop('disabled', 'disabled');
        var optionsavatar = {};
        $('#avatar').on('change', function () {
            var reader = new FileReader();
            reader.onload = function (e) {
                optionsavatar.imgSrc = e.target.result;
                //根据MIME判断上传的文件是不是图片类型
                if ((optionsavatar.imgSrc).indexOf("image/") == -1) {
                    parent.layer.alert("文件格式错误，请上传图片类型,如：JPG,JEPG，PNG后缀的文件。", {icon: 2, title: "系统提示"});
                } else {
                    $('#imgpreviewavatar').attr('src', e.target.result);
                    $('#imgpreviewavatar').attr('hidden', false);
                }
            }
            reader.readAsDataURL(this.files[0]);
        })

        var optionsselfie = {}
        $('#selfieImage').on('change', function () {
            var reader = new FileReader();
            reader.onload = function (e) {
                optionsselfie.imgSrc = e.target.result;
                //根据MIME判断上传的文件是不是图片类型
                if ((optionsselfie.imgSrc).indexOf("image/") == -1) {
                    parent.layer.alert("文件格式错误，请上传图片类型,如：JPG,JEPG，PNG后缀的文件。", {icon: 2, title: "系统提示"});
                } else {
                    $('#imgpreviewselfie').attr('src', e.target.result);
                    $('#imgpreviewselfie').attr('hidden', false);
                }
            }
            reader.readAsDataURL(this.files[0]);
        })

    });


</script>
</body>
</html>
